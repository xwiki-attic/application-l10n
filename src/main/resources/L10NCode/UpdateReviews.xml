<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>L10NCode</web>
  <name>UpdateReviews</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent/>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1325372400000</creationDate>
  <date>1325372400000</date>
  <contentUpdateDate>1325372400000</contentUpdateDate>
  <version>1.1</version>
  <title>UpdateReviews</title>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/1.0</syntaxId>
  <hidden>false</hidden>
  <object>
    <class>
      <name>XWiki.XWikiComments</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <author>
        <disabled>0</disabled>
        <name>author</name>
        <number>1</number>
        <prettyName>Author</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </author>
      <comment>
        <disabled>0</disabled>
        <name>comment</name>
        <number>5</number>
        <prettyName>Comment</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </comment>
      <date>
        <dateFormat>dd/MM/yyyy HH:mm:ss</dateFormat>
        <disabled>0</disabled>
        <emptyIsToday>1</emptyIsToday>
        <name>date</name>
        <number>4</number>
        <picker>1</picker>
        <prettyName>Date</prettyName>
        <size>20</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.DateClass</classType>
      </date>
      <highlight>
        <disabled>0</disabled>
        <name>highlight</name>
        <number>2</number>
        <prettyName>Highlighted Text</prettyName>
        <rows>2</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </highlight>
      <originalSelection>
        <disabled>0</disabled>
        <name>originalSelection</name>
        <number>9</number>
        <prettyName>Original Selection</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </originalSelection>
      <replyto>
        <disabled>0</disabled>
        <name>replyto</name>
        <number>3</number>
        <numberType>integer</numberType>
        <prettyName>Reply To</prettyName>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
      </replyto>
      <selection>
        <disabled>0</disabled>
        <name>selection</name>
        <number>6</number>
        <prettyName>Selection</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selection>
      <selectionLeftContext>
        <disabled>0</disabled>
        <name>selectionLeftContext</name>
        <number>7</number>
        <prettyName>Selection Left Context</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selectionLeftContext>
      <selectionRightContext>
        <disabled>0</disabled>
        <name>selectionRightContext</name>
        <number>8</number>
        <prettyName>Selection Right Context</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selectionRightContext>
      <state>
        <disabled>0</disabled>
        <name>state</name>
        <number>11</number>
        <prettyName>State</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </state>
      <target>
        <disabled>0</disabled>
        <name>target</name>
        <number>10</number>
        <prettyName>Target</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </target>
    </class>
    <name>L10NCode.UpdateReviews</name>
    <number>0</number>
    <className>XWiki.XWikiComments</className>
    <guid>c25cef46-a26b-4aef-a089-f56ecf6702a2</guid>
    <property>
      <author>XWiki.StefanBachert</author>
    </property>
    <property>
      <comment>OK complete in capital letters</comment>
    </property>
    <property>
      <date>2010-02-17 20:48:21.0</date>
    </property>
    <property>
      <replyto/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiComments</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <author>
        <disabled>0</disabled>
        <name>author</name>
        <number>1</number>
        <prettyName>Author</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </author>
      <comment>
        <disabled>0</disabled>
        <name>comment</name>
        <number>5</number>
        <prettyName>Comment</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </comment>
      <date>
        <dateFormat>dd/MM/yyyy HH:mm:ss</dateFormat>
        <disabled>0</disabled>
        <emptyIsToday>1</emptyIsToday>
        <name>date</name>
        <number>4</number>
        <picker>1</picker>
        <prettyName>Date</prettyName>
        <size>20</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.DateClass</classType>
      </date>
      <highlight>
        <disabled>0</disabled>
        <name>highlight</name>
        <number>2</number>
        <prettyName>Highlighted Text</prettyName>
        <rows>2</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </highlight>
      <originalSelection>
        <disabled>0</disabled>
        <name>originalSelection</name>
        <number>9</number>
        <prettyName>Original Selection</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </originalSelection>
      <replyto>
        <disabled>0</disabled>
        <name>replyto</name>
        <number>3</number>
        <numberType>integer</numberType>
        <prettyName>Reply To</prettyName>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
      </replyto>
      <selection>
        <disabled>0</disabled>
        <name>selection</name>
        <number>6</number>
        <prettyName>Selection</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selection>
      <selectionLeftContext>
        <disabled>0</disabled>
        <name>selectionLeftContext</name>
        <number>7</number>
        <prettyName>Selection Left Context</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selectionLeftContext>
      <selectionRightContext>
        <disabled>0</disabled>
        <name>selectionRightContext</name>
        <number>8</number>
        <prettyName>Selection Right Context</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </selectionRightContext>
      <state>
        <disabled>0</disabled>
        <name>state</name>
        <number>11</number>
        <prettyName>State</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </state>
      <target>
        <disabled>0</disabled>
        <name>target</name>
        <number>10</number>
        <prettyName>Target</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </target>
    </class>
    <name>L10NCode.UpdateReviews</name>
    <number>1</number>
    <className>XWiki.XWikiComments</className>
    <guid>1a679235-19bb-49b9-902f-7d6f13d52649</guid>
    <property>
      <author>XWiki.StefanBachert</author>
    </property>
    <property>
      <comment>Replaced "Sandbox" with "Sandkasten"
Tab is still english, "Reiter" is the real german word</comment>
    </property>
    <property>
      <date>2010-02-17 20:54:10.0</date>
    </property>
    <property>
      <replyto/>
    </property>
  </object>
  <content>1 Updating Reviews

#set($trans = $xwiki.parseGroovyFromPage("L10NCode.L10NGroovy"))
$trans.setContext($context, $xwiki)
#set($language = $request.language)
#set($startKey = $request.startKey)
#set($name = $request.name)
#set($app = $request.app)
#set($pages = $request.pages.split(","))

#foreach($page in $pages)
#set($updatereview = "")
#set($updatereview = $request.get("${page}_review"))
#set($previoustrans = $request.get("${page}_previoustranslatedtext"))
#set($newtrans = $request.get("${page}_translatedtext"))
#set($transdoc = $xwiki.getDocument($page))
#set($ok = $transdoc.use("L10NCode.TranslationClass"))
#set($save = false)
#if($previoustrans!=$newtrans)
* Updating translation for page $page
 #set($save = true)
 #set($ok = $transdoc.set("translatedtext", $newtrans))
#end
#if($updatereview &amp;&amp; $updatereview=="1")
* Updating review for page $page
 #set($save = true)
 #set($origtext = $trans.getOriginalTranslation($transdoc))
 #set($ok = $transdoc.set("validatedtranslatedtext", $transdoc.getValue("translatedtext")))
 #set($ok = $transdoc.set("originaltext", $origtext))
 #set($ok = $transdoc.set("status", "validated"))
#end
#if($save)
 $transdoc.save()
#end
#end
## clear cache
$trans.clearCache($app, $name, $language)

#if($request.startKey) [Continue with review&gt;${name}?action=review&amp;language=${language}&amp;startKey=${startKey}] - #end [Back to review page&gt;${name}?action=review&amp;language=$language] - [Back to translation file&gt;$name]</content>
</xwikidoc>
